<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>WASI版猜数字 - huangjj27&#x27;s Tech blog</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../tauri-single-instance-bug-dangling.html">由 tauri 单例模式 bug “意外修复” 发现的 dangling</a></li><li class="chapter-item expanded "><a href="../load-wasm-mistake.html">尝试在单 HTML 文件中嵌入 WASM 模块的错误操作</a></li><li class="chapter-item expanded "><a href="../reservoir.html">蓄水池算法改进 - 面向抽奖场景保证等概率性</a></li><li class="chapter-item expanded "><a href="../interview.html">记一次面试</a></li><li class="chapter-item expanded "><a href="../snake-with-bevy.html">用 Bevy 游戏引擎编写贪吃蛇（译）</a></li><li class="chapter-item expanded "><a href="../rust-safe-apps-51.html">Rust 安全应用开发51条</a></li><li class="chapter-item expanded "><a href="../rust-tianhe-ii.html">在天河二号上配置 Rust 运行环境</a></li><li class="chapter-item expanded "><a href="../rust-patterns/intro.html">设计模式在 Rust 中的实践</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../rust-patterns/builder.html">构建器（Builder）模式</a></li><li class="chapter-item expanded "><a href="../rust-patterns/abstract-factory.html">抽象工厂（Abstract Factory）模式</a></li></ol></li><li class="chapter-item expanded "><a href="../rust-mirror.html">Rust 镜像</a></li><li class="chapter-item expanded "><a href="../rust-ffi.html">在 WSL 中学习 Rust FFI</a></li><li class="chapter-item expanded "><a href="../wasi/intro.html">WASI探索</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../wasi/wasi_and_wasmtime.html">WASI简介与Wasmtime配置</a></li><li class="chapter-item expanded "><a href="../wasi/wasi_guess.html" class="active">WASI版猜数字</a></li></ol></li><li class="chapter-item expanded "><a href="../number_theory/intro.html">初等数论自我探索</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../number_theory/if_2n-p_is_divided_by_p.html">若质数p不能整除偶数2n，则p不整除2n-p</a></li><li class="chapter-item expanded "><a href="../number_theory/single-composite-divsion.html">整数和它两倍间的合数的性质</a></li><li class="chapter-item expanded "><a href="../number_theory/goldbachs-conjecture.html">用初等数论探索哥德巴赫猜想</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="../resume.html">关于我</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">huangjj27&#x27;s Tech blog</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/huangjj27/huangjj27.github.io" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="wasi探索二----wasi版猜数字"><a class="header" href="#wasi探索二----wasi版猜数字">WASI探索（二） -- WASI版猜数字</a></h1>
<blockquote>
<p>猜数字作为入门Rust时第一次编写并具有实际功能的程序，适合让读者快速掌握rust的基本概念。同时，为了让程序更加有趣，博主在原本的猜数字程序上添加了日志和从运行时参数传递游戏难度的功能。此外，由于博主偏好改变，本文还会涉及到另外一款WASI运行时Wasmer，以及他们为了丰富WASI生态而推出的wasm包管理器wapm。</p>
</blockquote>
<h2 id="阅读须知"><a class="header" href="#阅读须知">阅读须知</a></h2>
<p>学习外部资料更有助于读者了解相关生态，因此本文将不赘述：</p>
<ul>
<li><a href="/posts/first-wasi">WASI是什么？</a></li>
<li><a href="https://wapm.io/help/install">Wasmer与wapm如何安装？</a></li>
<li><a href="https://www.rust-lang.org/zh-CN/">rust是什么？</a> <a href="https://www.rust-lang.org/zh-CN/tools/install">如何安装Rust？</a> <a href="https://www.rust-lang.org/zh-CN/learn">如何学习rust？</a></li>
<li><a href="https://doc.rust-lang.org/cargo/index.html">cargo是什么？要怎样使用？</a></li>
<li><a href="https://doc.rust-lang.org/book/ch02-00-guessing-game-tutorial.html">猜数字原版程序在哪？</a></li>
<li><a href="https://docs.rs/log/0.4.6/log/">log crate</a>与<a href="https://docs.rs/env_logger/0.6.1/env_logger/">env_log crate</a>详细如何使用？</li>
<li><a href="https://docs.rs/releases/search?query=structopt">structopt</a>如何使用？</li>
</ul>
<p>而阅读本文，你将了解：</p>
<ul>
<li>如何用日志debug的一些原则</li>
<li>一个简单的配置文件的设计</li>
<li>读者对Wasmer的一些浅薄看法</li>
</ul>
<h2 id="原版猜数字"><a class="header" href="#原版猜数字">原版猜数字</a></h2>
<p>我们从<a href="https://doc.rust-lang.org/book/ch02-00-guessing-game-tutorial.html">官方书</a>拷贝了一份猜数字程序：</p>
<pre><pre class="playground"><code class="language-rust no_run edition2018">// main.rs
use std::io;
use std::cmp::Ordering;
use rand::Rng;

fn main() {
    println!(&quot;Guess the number!&quot;);

    let secret_number = rand::thread_rng().gen_range(1, 101);

    loop {
        println!(&quot;Please input your guess.&quot;);

        let mut guess = String::new();

        io::stdin().read_line(&amp;mut guess)
            .expect(&quot;Failed to read line&quot;);

        let guess: u32 = match guess.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };

        println!(&quot;You guessed: {}&quot;, guess);

        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!(&quot;Too small!&quot;),
            Ordering::Greater =&gt; println!(&quot;Too big!&quot;),
            Ordering::Equal =&gt; {
                println!(&quot;You win!&quot;);
                break;
            }
        }
    }
}
</code></pre></pre>
<pre><code class="language-toml"># Cargo.toml
[package]
name = &quot;guessing_game&quot;
version = &quot;0.1.0&quot;
authors = [&quot;Your Name &lt;you@example.com&gt;&quot;]
edition = &quot;2018&quot;

[dependencies]
rand = &quot;0.3.14&quot;
</code></pre>
<h2 id="一次游戏只猜一个数"><a class="header" href="#一次游戏只猜一个数">一次游戏只猜一个数</a></h2>
<p>我们可以看到，这个程序每次运行，只能猜一个数字，如果要继续玩就只能重新启动。但是博主想让这个游戏，能在一次运行时
可以生成不同难度关卡，因此首先我们将“猜一个数字”逻辑抽取成可复用函数</p>
<pre><pre class="playground"><code class="language-rust no_run edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// main.rs
fn guess_a_number() {
    println!(&quot;Guess the number!&quot;);

    let secret_number = rand::thread_rng().gen_range(1, 101);

    loop {
        println!(&quot;Please input your guess.&quot;);

        let mut guess_str = String::new();

        io::stdin().read_line(&amp;mut guess_str)
            .expect(&quot;Failed to read line&quot;);

        let guess: u32 = match guess_str.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; continue,
        };

        println!(&quot;You guessed: {}&quot;, guess);

        match guess.cmp(&amp;secret_number) {
            Ordering::Less =&gt; println!(&quot;Too small!&quot;),
            Ordering::Greater =&gt; println!(&quot;Too big!&quot;),
            Ordering::Equal =&gt; {
                println!(&quot;You win!&quot;);
                break;
            }
        }
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>再将配置文件修改一下：</p>
<pre><code class="language-toml"># guess_wasi/Cargo.toml
[package]
name = &quot;guess_wasi&quot;
version = &quot;0.1.0&quot;
authors = [&quot;huangjj27 &lt;huangjj.27@qq.com&gt;&quot;]
edition = &quot;2018&quot;

[dependencies]
rand = &quot;0.7&quot;
</code></pre>
<p>此外，猜数字游戏的难度取决于随机生成数字的范围, 为了生成不同的难度关卡，我们需要<code>guess_a_number</code>接受一组控制
生成数字范围的参数：</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// main.rs
/// 生成熟悉范围的下界（lower bound，lb)与上界（higher bound，hb）在主函数中读取配置文件得到
fn guess_a_number((lb, hb): (u32, u32)) {
    println!(&quot;Guess the number!&quot;);

    let secret_number = rand::thread_rng().gen_range(lb, hb + 1);

    // ...
}
<span class="boring">}
</span></code></pre></pre>
<p>这里在传入参数时，直接<a href="https://doc.rust-lang.org/book/ch18-03-pattern-syntax.html?highlight=destruct#destructuring-to-break-apart-values">解构</a>了<a href="https://doc.rust-lang.org/book/ch03-02-data-types.html#compound-types">元组</a>, 这样后面就可以直接使用传入的上界与下界来控制生成数范围</p>
<p>然后，博主发现， 原版猜数字如果解析数字错误的话会直接跳过，博主觉得这里应该至少提醒一下用户输入错误了：</p>
<pre><pre class="playground"><code class="language-rust edition2018"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>// main.rs
fn guess_a_number((lb, hb): (u32, u32)) {
    // ...
        let guess: u32 = match guess_str.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; {
                println!(&quot;Input not a number! please input a number&quot;);
                continue;
            },
        };
    // ...
}
<span class="boring">}
</span></code></pre></pre>
<h2 id="加上log追踪生成的数据情况"><a class="header" href="#加上log追踪生成的数据情况">加上log追踪生成的数据情况</a></h2>
<p>使用log去追踪数据与可能产生bug的代码有以下好处：</p>
<ul>
<li>了解运行时所关注的数据情况， 方便定位bug</li>
<li>清晰地知道实际运行流程是否如期望那样执行</li>
<li>即便使用release版目标， 仍然可以获得需要的分析信息</li>
<li>区分产生信息的层级，以便将精力集中在优先需要处理的信息中</li>
</ul>
<p>回到猜数字游戏上，博主想要知道每一次游戏中知道生成的<code>secret_number</code>是多少， 并且根据运行时输入的日志层级的参数
决定是否显示这个数字，需求相对简单，因此使用rust生态中比较常用的<a href="https://docs.rs/log/0.4.6/log/">log crate</a>与<a href="https://docs.rs/env_logger/0.6.1/env_logger/">env_log crate</a>。在<code>Cargo.toml</code>中加入两个新依赖：</p>
<pre><code class="language-toml"># guess_wasi/Cargo.toml

# ...

[dependencies]
rand = &quot;0.7&quot;

# 总是使用最新的log与env_log
log = &quot;*&quot;
env_logger = &quot;*&quot;
</code></pre>
<p>加入追踪日志代码：</p>
<pre><pre class="playground"><code class="language-rust edition2018">// main.rs
use log::{trace, debug};

fn main() {
    // 别忘了初始化日志生成器， 才能获取日志！
    env_log::init();
    guess_a_number((1, 100));
}

fn guess_a_number((lb, hb): (u32, u32)) {
    println!(&quot;Guess the number!&quot;);

    let secret_number = rand::thread_rng().gen_range(lb, hb + 1);
    trace!(&quot;secret number: {}&quot;, secret);

    loop {
        println!(&quot;Please input your guess.&quot;);

        let mut guess_str = String::new();
        io::stdin().read_line(&amp;mut guess_str)
            .expect(&quot;Failed to read line&quot;);
        debug!(&quot;scaned string: {:?}&quot;, guess_str);

        // ...
    }
}
</code></pre></pre>
<h2 id="向高难度挑战"><a class="header" href="#向高难度挑战">向高难度挑战！</a></h2>
<p>现在我们来到最后了一个需求：通过运行时参数来给每次游戏输入多个游戏难度，这个难度由随机数生成的范围决定-- 随机数
生成的范围越大，一次猜中这个数的概率就越小。为方便地写出输入参数的命令，我们需要引入<code>structopt</code>库（crate）,
最后获得类似<code>--levels=10 100 1000</code>这样的参数输入方式, 参数中每个数字表示每次生成随机数的生成范围上界。</p>
<p>配置文件追加：</p>
<pre><code class="language-toml"># guess_wasi/Cargo.toml

# ...

[dependencies]
rand = &quot;0.7&quot;

# 总是使用最新的log与env_log
log = &quot;*&quot;
env_logger = &quot;*&quot;

structopt = &quot;*&quot;
</code></pre>
<p>编写参数代码。</p>
<pre><pre class="playground"><code class="language-rust edition2018">// main.rs

// ...
use structopt::StructOpt;

// 定义参数只需要把他们的名字和类型写在一个参数结构体中即可！
#[derive(StructOpt)]
#[structopt(name=&quot;guess_wasi&quot;)]
struct Opt {
    #[structopt(long=&quot;levels&quot;)]
    levels: Vec&lt;u32&gt;,
}

fn main() {
    env_logger::init();

    // 获取并访问levels参数, 只需要访问参数结构体的对应成员即可， 细节处理可以方便地交给库执行！
    let opt = Opt::from_args();
    for &amp;lv in &amp;opt.levels {
        println!(&quot;given number range 0~{}&quot;, lv);
        guess_a_number((0, lv));
    }
}
</code></pre></pre>
<h2 id="完整代码"><a class="header" href="#完整代码">完整代码</a></h2>
<pre><code class="language-toml">[package]
name = &quot;guess_wasi&quot;
version = &quot;0.1.0&quot;
authors = [&quot;huangjj27 &lt;huangjj.27@qq.com&gt;&quot;]
edition = &quot;2018&quot;

[dependencies]
rand = &quot;0.7&quot;

# 总是使用最新的log与env_log
log = &quot;*&quot;
env_logger = &quot;*&quot;

structopt = &quot;*&quot;
</code></pre>
<pre><pre class="playground"><code class="language-rust edition2018">// guess_wasi/main.rs
use std::io;
use std::cmp::Ordering;
use rand::Rng;
use log::{debug, trace};

use structopt::StructOpt;

// 定义参数只需要把他们的名字和类型写在一个参数结构体中即可！
#[derive(StructOpt)]
#[structopt(name=&quot;guess_wasi&quot;)]
struct Opt {
    #[structopt(long=&quot;levels&quot;)]
    levels: Vec&lt;u32&gt;,
}

fn main() {
    env_logger::init();

    // 获取并访问levels参数, 只需要访问参数结构体的对应成员即可， 细节处理可以方便地交给库执行！
    let opt = Opt::from_args();
    for &amp;lv in &amp;opt.levels {
        println!(&quot;given number range 0~{}&quot;, lv);
        guess_a_number((0, lv));
    }
}

// 一场游戏有多个难度，我们每个难度只猜一个数字，然后变难
fn guess_a_number((lb, hb): (u32, u32)) {
    let secret = rand::thread_rng().gen_range(lb, hb + 1);
    trace!(&quot;secret number: {}&quot;, secret);

    loop {
        println!(&quot;Please input your guess.&quot;);

        let mut guess_str = String::new();
        io::stdin().read_line(&amp;mut guess_str)
            .expect(&quot;Failed to read line&quot;);
        debug!(&quot;scaned string: {:?}&quot;, guess_str);

        let guess: u32 = match guess_str.trim().parse() {
            Ok(num) =&gt; num,
            Err(_) =&gt; {
                println!(&quot;Input not a number! please input a number&quot;);
                continue;
            },
        };

        println!(&quot;You guessed: {}&quot;, guess);

        match guess.cmp(&amp;secret) {
            Ordering::Less =&gt; println!(&quot;too small!&quot;),
            Ordering::Greater =&gt; println!(&quot;too big!&quot;),
            Ordering::Equal =&gt; {
                println!(&quot;You get it!&quot;);
                break;
            }
        }
    }
}
</code></pre></pre>
<p>读到这里，读者可以发现前文<strong>根本没涉及到WASI，甚至没有涉及WASM</strong>。这因为WASI作为应用与运行时交互的接口，被rust编译器封装成为编译目标，读者只需要编译到对应目标即可让自己的程序在对应平台上运行. 这是Rust编程语言现代化与工程学的体现：
一般应用研发工程师可以通过使用已经适配所需平台的底层库(这些底层库通常已经针对所有支持平台做了最优化适配)，就能让自己的应用支持对应的平台而无需重新编写针对某平台的特化版本源码！</p>
<h2 id="是时候编译成wasi目标了"><a class="header" href="#是时候编译成wasi目标了">是时候编译成WASI目标了</a></h2>
<p>我们还需要添加对应的编译目标：</p>
<pre><code>rustup target add wasm32-wasi
</code></pre>
<p>编译到<code>wasm32-wasi</code>目标上：</p>
<pre><code>$ cargo build --target=wasm32-wasi --release
   Compiling proc-macro2 v1.0.18
   Compiling version_check v0.9.2
   Compiling unicode-xid v0.2.0
   Compiling syn v1.0.30
   Compiling cfg-if v0.1.10
   Compiling memchr v2.3.3
   Compiling getrandom v0.1.14
   Compiling wasi v0.9.0+wasi-snapshot-preview1
   Compiling lazy_static v1.4.0
   Compiling bitflags v1.2.1
   Compiling atty v0.2.14
   Compiling unicode-width v0.1.7
   Compiling unicode-segmentation v1.6.0
   Compiling log v0.4.8
   Compiling quick-error v1.2.3
   Compiling ansi_term v0.11.0
   Compiling ppv-lite86 v0.2.8
   Compiling regex-syntax v0.6.18
   Compiling strsim v0.8.0
   Compiling vec_map v0.8.2
   Compiling termcolor v1.1.0
   Compiling thread_local v1.0.1
   Compiling textwrap v0.11.0
   Compiling proc-macro-error-attr v1.0.2
   Compiling proc-macro-error v1.0.2
   Compiling humantime v1.3.0
   Compiling heck v0.3.1
   Compiling quote v1.0.7
   Compiling rand_core v0.5.1
   Compiling clap v2.33.1
   Compiling regex v1.3.9
   Compiling rand_chacha v0.2.2
   Compiling env_logger v0.7.1
   Compiling syn-mid v0.5.0
   Compiling rand v0.7.3
   Compiling structopt-derive v0.4.7
   Compiling structopt v0.3.14
   Compiling guess_wasi v0.1.0 (C:\Users\huangjj27\Documents\codes\huangjj27.github.io\code\guess_wasi)
    Finished release [optimized] target(s) in 4m 58s
</code></pre>
<p>现在，我们来运行一下程序吧：</p>
<pre><code>$ wasmer --version
wasmer 0.13.1
$ wasmer run .\target\wasm32-wasi\release\guess.wasm --env RUST_LOG=trace -- --levels 10 100 1000
given number range 0~10
[2020-06-09T14:55:58Z TRACE guess] secret number: 10
Please input your guess.
5
[2020-06-09T14:56:02Z DEBUG guess] scaned string: &quot;5\r\n&quot;
You guessed: 5
too small!
Please input your guess.
8
[2020-06-09T14:56:04Z DEBUG guess] scaned string: &quot;8\r\n&quot;
You guessed: 8
too small!
Please input your guess.
9
[2020-06-09T14:56:07Z DEBUG guess] scaned string: &quot;9\r\n&quot;
You guessed: 9
too small!
Please input your guess.
10
[2020-06-09T14:56:09Z DEBUG guess] scaned string: &quot;10\r\n&quot;
You guessed: 10
You get it!
given number range 0~100
[2020-06-09T14:56:09Z TRACE guess] secret number: 60
Please input your guess.
60
[2020-06-09T14:56:25Z DEBUG guess] scaned string: &quot;60\r\n&quot;
You guessed: 60
You get it!
given number range 0~1000
[2020-06-09T14:56:25Z TRACE guess] secret number: 715
Please input your guess.
300
[2020-06-09T14:56:32Z DEBUG guess] scaned string: &quot;300\r\n&quot;
You guessed: 300
too small!
Please input your guess.
720
[2020-06-09T14:56:38Z DEBUG guess] scaned string: &quot;720\r\n&quot;
You guessed: 720
too big!
Please input your guess.
716
[2020-06-09T14:56:41Z DEBUG guess] scaned string: &quot;716\r\n&quot;
You guessed: 716
too big!
Please input your guess.
714
[2020-06-09T14:56:46Z DEBUG guess] scaned string: &quot;714\r\n&quot;
You guessed: 714
too small!
Please input your guess.
715
[2020-06-09T14:56:48Z DEBUG guess] scaned string: &quot;715\r\n&quot;
You guessed: 715
You get it!
$
</code></pre>
<p>调试后，确认我们的程序可以正常执行了， 去掉<code>--env RUST_LOG=trace</code>参数，享受自己制作的这个小游戏吧！</p>
<!-- TODO：待更新 -->
<h2 id="wasmer与wapm"><a class="header" href="#wasmer与wapm">Wasmer与Wapm</a></h2>
<p><a href="https://github.com/wasmerio/wasmer">Wasmer</a>可以是说在WASI生态中响应速度仅次于Mozilla的组织，他们号称打造了
一款可以让代码“一次构建，处处运行”（Build Once, Run Anywhere.)的运行时环境，该环境可以运行ECMAScripten标准与
WASI标准的wasm栈机码。并且方便为wasm代码分发，该组织开发了类似于nodejs生态中npm的包管理工具wapm，这样用户就可以
很轻松地发布自己的程序，以及利用他人的程序了--这促进了WASM生态的发展，同时作为生态底层的领导者，Wasmer也将拥有
更多发言权。</p>
<p>作为边缘人士（稍微知道WASM生态但没很深入了解），博主看到这项目背后的布局很像上世纪Sun公司的Java和JVM（尽管WASM并不是Wasmer的发明，但这样反而不必为WASM这样可以作为主流编程语言编译目标工具投入过多精力宣传，可以集中精力去优化wasmer与wapm；同时因为wasmer是使用MIT协议授权，不会产生类似OracleJDK专利权所属的问题，相信随着生态的进一步发展，在虚拟机运行时领域会逐步替代JVM成为主流，届时将解放程序员更多生产力 -- 不必要求掌握Java而是通过自己熟悉的编程语言（c/c++/rust/python/...)通过统一的标准相互调用（进一步微型化的微服务）。</p>
<p>而这个在服务器/PC桌面应用占主导地位的标准，就是WASI。</p>

                    </main>

                    <hr>
                    <script src="https://utteranc.es/client.js"
                            repo="huangjj27/blog-gitment"
                            issue-term="title"
                            label="utterances"
                            theme="github-light"
                            crossorigin="anonymous"
                            async>
                    </script>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../wasi/wasi_and_wasmtime.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../number_theory/intro.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../wasi/wasi_and_wasmtime.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../number_theory/intro.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->

    </body>
</html>
